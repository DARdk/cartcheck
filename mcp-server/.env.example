# ==============================================================================
# CartChef MCP Server - Nemlig API Integration Service
# ==============================================================================
# Copy this file to .env and fill in the required values

# ==============================================================================
# APPLICATION SETTINGS
# ==============================================================================
NODE_ENV=development
APP_NAME=CartChef MCP Server
APP_VERSION=0.1.0
PORT=3001
HOST=0.0.0.0

# ==============================================================================
# MCP PROTOCOL CONFIGURATION
# ==============================================================================
# Model Context Protocol settings
MCP_SERVER_NAME=cartchef-nemlig
MCP_SERVER_VERSION=0.1.0
MCP_PROTOCOL_VERSION=2024-11-05

# Server capabilities
MCP_SUPPORTS_RESOURCES=true
MCP_SUPPORTS_TOOLS=true
MCP_SUPPORTS_PROMPTS=false

# ==============================================================================
# NEMLIG.COM API CONFIGURATION
# ==============================================================================
# Nemlig API Base URL and endpoints
NEMLIG_API_BASE_URL=https://api.nemlig.com
NEMLIG_WEB_BASE_URL=https://www.nemlig.com

# Nemlig user credentials
NEMLIG_USERNAME=your-nemlig-email@example.com
NEMLIG_PASSWORD=your-nemlig-password

# API endpoints (relative to base URL)
NEMLIG_LOGIN_ENDPOINT=/auth/login
NEMLIG_SEARCH_ENDPOINT=/api/search
NEMLIG_CART_ENDPOINT=/api/cart
NEMLIG_PRODUCTS_ENDPOINT=/api/products
NEMLIG_CATEGORIES_ENDPOINT=/api/categories

# ==============================================================================
# AUTHENTICATION & SESSION MANAGEMENT
# ==============================================================================
# Session configuration
SESSION_TIMEOUT=3600000  # 1 hour in milliseconds
SESSION_REFRESH_THRESHOLD=600000  # 10 minutes in milliseconds
MAX_CONCURRENT_SESSIONS=5

# Cookie settings
COOKIE_DOMAIN=.nemlig.com
COOKIE_SECURE=true
COOKIE_SAME_SITE=strict

# JWT for internal authentication
JWT_SECRET=your-internal-jwt-secret-32-characters-minimum
JWT_EXPIRATION=1h

# ==============================================================================
# RATE LIMITING & REQUEST CONFIGURATION
# ==============================================================================
# Rate limiting to respect Nemlig's API limits
RATE_LIMIT_REQUESTS=60
RATE_LIMIT_WINDOW=60000  # 1 minute in milliseconds
RATE_LIMIT_SKIP_SUCCESSFUL=false

# Request configuration
REQUEST_TIMEOUT=10000  # 10 seconds
REQUEST_RETRIES=3
REQUEST_RETRY_DELAY=1000  # 1 second
CONCURRENT_REQUESTS=10

# User agent for API requests
USER_AGENT=CartChef/1.0 (+https://cartchef.app)

# ==============================================================================
# CACHING CONFIGURATION
# ==============================================================================
# Redis for caching API responses
REDIS_URL=redis://localhost:6379/3
REDIS_PASSWORD=
REDIS_KEY_PREFIX=cartchef:mcp:

# Cache TTL settings (in seconds)
PRODUCT_CACHE_TTL=3600  # 1 hour
SEARCH_CACHE_TTL=300    # 5 minutes
CART_CACHE_TTL=60       # 1 minute
SESSION_CACHE_TTL=3600  # 1 hour

# ==============================================================================
# LOGGING CONFIGURATION
# ==============================================================================
LOG_LEVEL=info
LOG_FORMAT=combined
LOG_TIMESTAMP=true

# Log files
LOG_DIR=./logs
LOG_FILE_MAX_SIZE=10m
LOG_FILE_MAX_FILES=5

# Structured logging
USE_JSON_LOGGING=false
LOG_REQUESTS=true
LOG_RESPONSES=false  # Set to true for debugging (may contain sensitive data)

# ==============================================================================
# PRODUCT SEARCH & MATCHING
# ==============================================================================
# Search configuration
SEARCH_RESULTS_LIMIT=50
SEARCH_FUZZY_THRESHOLD=0.8
SEARCH_MIN_QUERY_LENGTH=2

# Product matching algorithms
ENABLE_FUZZY_MATCHING=true
ENABLE_BRAND_MATCHING=true
ENABLE_CATEGORY_FILTERING=true

# Ingredient normalization
ENABLE_UNIT_CONVERSION=true
DEFAULT_QUANTITY=1
DEFAULT_UNIT=stk

# ==============================================================================
# CART MANAGEMENT
# ==============================================================================
# Cart operation settings
CART_SYNC_INTERVAL=30000  # 30 seconds
MAX_CART_ITEMS=100
CART_TIMEOUT=1800000  # 30 minutes

# Cart validation
VALIDATE_CART_ITEMS=true
REMOVE_UNAVAILABLE_ITEMS=false
SUGGEST_ALTERNATIVES=true

# ==============================================================================
# ERROR HANDLING & RESILIENCE
# ==============================================================================
# Error retry configuration
MAX_API_RETRIES=3
RETRY_DELAY_BASE=1000  # Base delay in milliseconds
RETRY_DELAY_MAX=10000  # Maximum delay in milliseconds
RETRY_EXPONENTIAL_BASE=2

# Circuit breaker settings
CIRCUIT_BREAKER_THRESHOLD=5
CIRCUIT_BREAKER_TIMEOUT=30000
CIRCUIT_BREAKER_RESET_TIMEOUT=60000

# ==============================================================================
# MONITORING & HEALTH CHECKS
# ==============================================================================
# Health check configuration
HEALTH_CHECK_INTERVAL=30000
HEALTH_CHECK_TIMEOUT=5000
HEALTH_CHECK_NEMLIG_API=true

# Metrics collection
ENABLE_METRICS=true
METRICS_PORT=9091
METRICS_PATH=/metrics

# External monitoring
SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id
SENTRY_ENVIRONMENT=development

# ==============================================================================
# SECURITY CONFIGURATION
# ==============================================================================
# CORS settings
CORS_ORIGIN=["http://localhost:3000", "http://localhost:8000"]
CORS_METHODS=["GET", "POST", "PUT", "DELETE"]
CORS_CREDENTIALS=true

# Request validation
VALIDATE_REQUESTS=true
MAX_REQUEST_SIZE=1mb
ENABLE_CSRF_PROTECTION=false  # Set to true in production

# API key for internal communication
API_KEY=your-internal-api-key-change-this-in-production

# ==============================================================================
# DEVELOPMENT & DEBUGGING
# ==============================================================================
# Development mode settings
ENABLE_HOT_RELOAD=true
ENABLE_DEBUG_ROUTES=true
MOCK_NEMLIG_API=false

# Request/Response logging for debugging
LOG_API_REQUESTS=true
LOG_API_RESPONSES=false  # Enable carefully as it may log sensitive data
LOG_PERFORMANCE=true

# ==============================================================================
# WEBHOOK CONFIGURATION
# ==============================================================================
# Webhooks for notifying backend of changes
WEBHOOK_URL=http://localhost:8000/api/v1/webhooks/mcp
WEBHOOK_SECRET=your-webhook-secret
WEBHOOK_RETRY_ATTEMPTS=3
WEBHOOK_TIMEOUT=5000

# ==============================================================================
# SSL/TLS CONFIGURATION
# ==============================================================================
# SSL settings (for production)
SSL_ENABLED=false
SSL_CERT_PATH=./ssl/cert.pem
SSL_KEY_PATH=./ssl/key.pem
SSL_PASSPHRASE=

# ==============================================================================
# PERFORMANCE TUNING
# ==============================================================================
# Node.js performance settings
UV_THREADPOOL_SIZE=10
NODE_OPTIONS=--max-old-space-size=2048

# Connection pooling
HTTP_AGENT_KEEP_ALIVE=true
HTTP_AGENT_MAX_SOCKETS=50
HTTP_AGENT_TIMEOUT=5000